From bbc8e11478f8e7de6ac94165544b732e9bda03da Mon Sep 17 00:00:00 2001
From: Arik Nemtsov <arik@wizery.com>
Date: Tue, 24 Jul 2012 14:55:21 +0300
Subject: [PATCH 2/3] SoftapControllerTI: set correct permissions on conf file

Change-Id: I820adfaaf0cdab80aadfb4bc9f490d0426956a86
Signed-off-by: Arik Nemtsov <arik@wizery.com>
---
 SoftapControllerTI.cpp |   16 ++++++++++++++++
 1 files changed, 16 insertions(+), 0 deletions(-)

diff --git a/SoftapControllerTI.cpp b/SoftapControllerTI.cpp
index 4b14582..ed37f74 100644
--- a/SoftapControllerTI.cpp
+++ b/SoftapControllerTI.cpp
@@ -33,6 +33,8 @@
 #include <openssl/evp.h>
 #include <openssl/sha.h>
 
+#include <private/android_filesystem_config.h>
+
 #define LOG_TAG "SoftapController"
 #include <cutils/log.h>
 #include <cutils/properties.h>
@@ -592,6 +594,20 @@ int SoftapController::setSoftap(int argc, char *argv[]) {
     fclose(fp);
     fclose(fp2);
 
+    if (chmod(HOSTAPD_CONF_FILE, 0660) < 0) {
+        ALOGE("Error changing permissions of %s to 0660: %s",
+                HOSTAPD_CONF_FILE, strerror(errno));
+        unlink(HOSTAPD_CONF_FILE);
+        return -1;
+    }
+
+    if (chown(HOSTAPD_CONF_FILE, AID_SYSTEM, AID_WIFI) < 0) {
+        ALOGE("Error changing group ownership of %s to %d: %s",
+                HOSTAPD_CONF_FILE, AID_WIFI, strerror(errno));
+        unlink(HOSTAPD_CONF_FILE);
+        return -1;
+    }
+
     // we take the wakelock here because the stop/start is lengthy
     acquire_wake_lock(PARTIAL_WAKE_LOCK, AP_WAKE_LOCK);
 
-- 
1.7.9

